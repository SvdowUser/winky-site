<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Winky – Token tracker & risk radar</title>

  <style>
    :root {
      --bg: #050608;
      --card: #0b0f14;
      --accent: #00fff7;
      --accent-soft: rgba(0,255,247,0.12);
      --accent-strong: rgba(0,255,247,0.25);
      --text-main: #f7f7f7;
      --text-muted: #a3abb8;
      --danger: #ff4d72;
      --green: #7cff4d;
      --yellow: #ffc94d;
    }

    * { box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: radial-gradient(circle at top, #07121c 0, var(--bg) 55%);
      color: var(--text-main);
    }

    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* --- NAV --- */
    .nav {
      max-width: 980px;
      margin: 0 auto;
      padding: 18px 20px 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .nav-links a {
      margin-left: 18px;
      color: var(--text-muted);
      font-weight: 500;
    }
    .nav-links a:hover {
      color: var(--accent);
    }

    /* Winky eyes logo (wie auf Startseite) */
    .winky-logo {
      --size: 28px;
      display: flex;
      align-items: center;
      gap: calc(var(--size) * 0.18);
    }
    .winky-eye {
      width: calc(var(--size) * 0.38);
      height: calc(var(--size) * 0.38);
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 10px var(--accent-soft);
      transform-origin: center center;
    }
    .winky-eye.right {
      animation: winky-blink 14s infinite ease-in-out;
    }
    @keyframes winky-blink {
      0%, 94%, 100% { transform: scaleY(1) scaleX(1); }
      96% { transform: scaleY(0.12) scaleX(1.3); }
      97.5% { transform: scaleY(1) scaleX(1); }
    }
    .nav-brand-text {
      font-weight: 600;
      letter-spacing: 0.04em;
    }

    .nav-wallet {
      padding: 8px 16px;
      font-size: 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.04);
      cursor: pointer;
      transition: background .15s ease, box-shadow .15s ease, transform .15s ease;
    }
    .nav-wallet:hover {
      background: rgba(255,255,255,0.08);
      transform: translateY(-1px);
    }

    @media (max-width: 720px) {
      .nav { flex-wrap: wrap; gap: 10px; }
      .nav-links { display: none; }
      .nav-wallet { padding: 6px 12px; font-size: 12px; }
    }

    /* --- PAGE LAYOUT --- */
    .page {
      max-width: 980px;
      margin: 0 auto 80px;
      padding: 0 20px 40px;
    }

    .section-label {
      text-transform: uppercase;
      font-size: 11px;
      letter-spacing: 0.16em;
      color: var(--accent);
      margin-bottom: 6px;
    }

    h1.page-title {
      font-size: clamp(30px, 4vw, 36px);
      margin: 4px 0 8px;
    }

    .section-text {
      margin: 0 0 24px;
      color: var(--text-muted);
      font-size: 15px;
      max-width: 640px;
    }

    /* --- FILTER BAR --- */
    .filter-bar {
      margin-top: 14px;
      background: var(--card);
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 10px 14px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .filter-input {
      flex: 1 1 180px;
      min-width: 160px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(5,8,12,0.7);
      color: var(--text-main);
      padding: 8px 12px;
      font-size: 13px;
      outline: none;
    }
    .filter-input::placeholder {
      color: rgba(200,210,225,0.7);
    }

    .filter-select {
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(5,8,12,0.7);
      color: var(--text-main);
      padding: 8px 12px;
      font-size: 13px;
      outline: none;
    }

    .filter-checkbox {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--text-muted);
      white-space: nowrap;
    }

    /* --- TABLE --- */
    .table-wrapper {
      margin-top: 24px;
      border-radius: 18px;
      background: rgba(0,0,0,0.32);
      border: 1px solid rgba(255,255,255,0.06);
      overflow: hidden;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    thead {
      background: rgba(9,14,20,0.98);
    }

    th, td {
      padding: 10px 14px;
      text-align: left;
    }

    th {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--text-muted);
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }

    tbody tr:nth-child(even) {
      background: rgba(255,255,255,0.01);
    }

    tbody tr:hover {
      background: rgba(0,255,247,0.04);
    }

    .token-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .token-symbol {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid rgba(255,255,255,0.12);
      white-space: nowrap;
    }

    .badge-risk-low {
      border-color: rgba(124,255,77,0.6);
      color: var(--green);
      background: rgba(124,255,77,0.1);
    }
    .badge-risk-medium {
      border-color: rgba(255,201,77,0.7);
      color: var(--yellow);
      background: rgba(255,201,77,0.16);
    }
    .badge-risk-high {
      border-color: rgba(255,77,114,0.6);
      color: var(--danger);
      background: rgba(255,77,114,0.14);
    }

    .badge-winky {
      border-color: rgba(0,255,247,0.7);
      color: var(--accent);
      background: rgba(0,255,247,0.12);
    }

    .btn-table {
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(5,8,12,0.9);
      color: var(--text-main);
      font-size: 12px;
      cursor: pointer;
      text-decoration: none;
      white-space: nowrap;
    }

    .btn-table:hover {
      background: rgba(255,255,255,0.06);
    }

    .table-footnote {
      margin-top: 8px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .empty-state {
      padding: 20px 16px;
      font-size: 13px;
      color: var(--text-muted);
      text-align: center;
    }

    @media (max-width: 720px) {
      th:nth-child(4),
      th:nth-child(5),
      td:nth-child(4),
      td:nth-child(5) {
        display: none; /* Market cap + Volume auf Handy ausblenden */
      }
    }

    /* FOOTER */
    .footer {
      max-width: 980px;
      margin: 0 auto;
      padding: 16px 20px 32px;
      font-size: 12px;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 6px;
      border-top: 1px solid rgba(255,255,255,0.08);
    }
  </style>
</head>

<body>
  <!-- NAV -->
  <header class="nav">
    <div class="nav-left">
      <div class="winky-logo">
        <span class="winky-eye left"></span>
        <span class="winky-eye right"></span>
      </div>
      <span class="nav-brand-text">Winky</span>
      <nav class="nav-links">
        <a href="index.html">Home</a>
        <a href="dashboard.html">Dashboard</a>
        <a href="tracker.html">Token tracker</a>
      </nav>
    </div>

    <button id="wallet-connect-btn" class="nav-wallet" type="button">
      Connect wallet
    </button>
  </header>

  <!-- PAGE -->
  <main class="page">
    <div class="section-label">Explorer</div>
    <h1 class="page-title">Token tracker & risk radar</h1>
    <p class="section-text">
      View popular Solana meme tokens, basic market data and an early risk score.
      Data is mocked for now – later this page can read live data from Dexscreener
      and from Winky launches.
    </p>

    <!-- FILTERS -->
    <div class="filter-bar">
      <input
        id="search-input"
        class="filter-input"
        type="text"
        placeholder="Search by name or ticker…"
      />

      <select id="risk-filter" class="filter-select">
        <option value="all">Risk: all</option>
        <option value="low">Risk: low</option>
        <option value="medium">Risk: medium</option>
        <option value="high">Risk: high</option>
      </select>

      <select id="mc-filter" class="filter-select">
        <option value="all">Market cap: all</option>
        <option value="small">&lt; $1M</option>
        <option value="mid">$1M – $10M</option>
        <option value="large">&gt; $10M</option>
      </select>

      <label class="filter-checkbox">
        <input id="winky-only" type="checkbox" />
        Only Winky launches
      </label>
    </div>

    <!-- TABLE -->
    <div class="table-wrapper" id="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Token</th>
            <th>Chain</th>
            <th>Market cap</th>
            <th>24h volume</th>
            <th>Risk</th>
            <th>From Winky</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="token-tbody">
          <!-- rows werden per JS eingefügt -->
        </tbody>
      </table>
      <div id="empty-state" class="empty-state" style="display:none;">
        No tokens found for this filter. Try a different search or risk level.
      </div>
    </div>

    <p class="table-footnote">
      Risk level and Winky tags are rough previews for now.
      Bubble maps &amp; on-chain holder analysis can be added later.
      Live data refresh (e.g. every 5–10 minutes) can be connected once the backend is ready.
    </p>
  </main>

  <!-- FOOTER -->
  <footer class="footer">
    <span>© 2025 Winky · Experimental Solana meme tooling. DYOR.</span>
    <span>
      <a href="index.html">Back to home</a>
      ·
      <a href="https://dexscreener.com" target="_blank" rel="noreferrer">Dexscreener</a>
    </span>
  </footer>

  <script>
    // --- Simple wallet button placeholder (gleich wie auf Startseite anpassbar) ---
    document.getElementById('wallet-connect-btn')
      .addEventListener('click', () => {
        alert('Wallet connect placeholder on tracker page – same logic as index.html can be reused here.');
      });

    // === Dexscreener integration (client-side demo) ===
    const API_URL =
      'https://api.dexscreener.com/latest/dex/search?q=solana'; // einfache Suche nach Solana-Pairs

    let ALL_TOKENS = [];

    async function fetchTokens() {
      try {
        const res = await fetch(API_URL);
        const json = await res.json();
        const pairs = json.pairs || [];

        // Sortiere nach 24h-Volumen (desc), nimm max. 50
        pairs.sort((a, b) => (b?.volume?.h24 || 0) - (a?.volume?.h24 || 0));
        const top = pairs.slice(0, 50);

        ALL_TOKENS = top.map(pair => {
          const base = pair.baseToken || {};
          const chain = pair.chainId || 'solana';
          const mc = pair.fdv || pair.marketCap || null;
          const vol24 = pair.volume?.h24 ?? null;
          const liquidityUsd = pair.liquidity?.usd ?? 0;

          const risk = computeRisk(liquidityUsd, mc);

          // TODO: später über Backend markieren, welche Tokens wirklich von Winky gelauncht wurden
          const isWinkyLaunch = false;

          return {
            name: base.name || 'Unknown',
            symbol: base.symbol || '?',
            chain,
            marketCap: mc,
            volume24h: vol24,
            risk,
            winkyLaunch: isWinkyLaunch,
            url: pair.url || 'https://dexscreener.com'
          };
        });

        renderTable();
      } catch (err) {
        console.error('Error loading Dexscreener data:', err);
        const tbody = document.getElementById('token-tbody');
        const empty = document.getElementById('empty-state');
        tbody.innerHTML = '';
        empty.style.display = 'block';
        empty.textContent =
          'Could not load live data from Dexscreener (possibly CORS or network issue). ' +
          'You can still connect this page via a small backend later.';
      }
    }

    function computeRisk(liquidityUsd, marketCap) {
      // Sehr simple Heuristik nur als Platzhalter
      if (!liquidityUsd || liquidityUsd < 5000) return 'high';
      if (liquidityUsd < 50000) return 'medium';
      return 'low';
    }

    function formatUsd(value) {
      if (value == null) return '–';
      try {
        return new Intl.NumberFormat('en-US', {
          style: 'currency',
          currency: 'USD',
          notation: 'compact',
          maximumFractionDigits: 1
        }).format(value);
      } catch {
        return '$' + value.toLocaleString();
      }
    }

    function renderTable() {
      const tbody = document.getElementById('token-tbody');
      const empty = document.getElementById('empty-state');

      const search = document.getElementById('search-input').value.trim().toLowerCase();
      const riskFilter = document.getElementById('risk-filter').value;
      const mcFilter = document.getElementById('mc-filter').value;
      const winkyOnly = document.getElementById('winky-only').checked;

      const filtered = ALL_TOKENS.filter(t => {
        if (search &&
          !(t.name.toLowerCase().includes(search) ||
            t.symbol.toLowerCase().includes(search))) {
          return false;
        }

        if (riskFilter !== 'all' && t.risk !== riskFilter) {
          return false;
        }

        const mc = t.marketCap || 0;
        if (mcFilter === 'small' && !(mc > 0 && mc < 1_000_000)) return false;
        if (mcFilter === 'mid' && !(mc >= 1_000_000 && mc < 10_000_000)) return false;
        if (mcFilter === 'large' && !(mc >= 10_000_000)) return false;

        if (winkyOnly && !t.winkyLaunch) return false;

        return true;
      });

      if (!filtered.length) {
        tbody.innerHTML = '';
        empty.style.display = 'block';
        return;
      }

      empty.style.display = 'none';
      tbody.innerHTML = filtered.map(t => {
        const riskClass =
          t.risk === 'low' ? 'badge-risk-low'
          : t.risk === 'medium' ? 'badge-risk-medium'
          : 'badge-risk-high';

        const winkyCell = t.winkyLaunch
          ? '<span class="badge badge-winky">Winky launch</span>'
          : '—';

        return `
          <tr>
            <td>
              <div class="token-main">
                <span>${escapeHtml(t.name)}</span>
                <span class="token-symbol">$${escapeHtml(t.symbol)}</span>
              </div>
            </td>
            <td>${escapeHtml(t.chain)}</td>
            <td>${formatUsd(t.marketCap)}</td>
            <td>${formatUsd(t.volume24h)}</td>
            <td><span class="badge ${riskClass}">
              ${t.risk.charAt(0).toUpperCase() + t.risk.slice(1)}
            </span></td>
            <td>${winkyCell}</td>
            <td>
              <a class="btn-table" href="${t.url}" target="_blank" rel="noreferrer">
                View on Dexscreener
              </a>
            </td>
          </tr>
        `;
      }).join('');
    }

    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    // Filter-Events
    document.getElementById('search-input').addEventListener('input', renderTable);
    document.getElementById('risk-filter').addEventListener('change', renderTable);
    document.getElementById('mc-filter').addEventListener('change', renderTable);
    document.getElementById('winky-only').addEventListener('change', renderTable);

    // Alle paar Minuten könnte man neu laden (hier nur vorbereitet)
    // setInterval(fetchTokens, 5 * 60 * 1000);

    // Initial load
    fetchTokens();
  </script>
</body>
</html>
